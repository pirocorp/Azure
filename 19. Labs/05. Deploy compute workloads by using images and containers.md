# Deploy compute workloads by using images and containers

# Architecture diagram

![image](https://user-images.githubusercontent.com/34960418/168256141-a8364e3a-09b9-4ee0-ac39-409f5cc44762.png)


# Create a VM by using the Azure Command-Line Interface (CLI)

## Login to Azure

```bash
az login
```

![image](https://user-images.githubusercontent.com/34960418/168256771-b3b03ffa-7941-410b-ba0c-71db601aa0ab.png)


## Create resource group 

Run the following command to get the version of the Azure CLI tool:

```bash
az --version
```
  
![image](https://user-images.githubusercontent.com/34960418/168257914-eeb44b20-c26e-452b-9e43-52d74b0c7812.png)


Run the following command to get a list of subgroups and commands at the root level of the CLI

```bash
az --help
```

![image](https://user-images.githubusercontent.com/34960418/168257639-f661683d-8597-4a6c-b5cf-4eb583720c7c.png)


Create resource group in **(US) East US** named **ContainerCompute**

```bash
az group create --location eastus --name ContainerCompute
```

![image](https://user-images.githubusercontent.com/34960418/168257254-fbd4779e-fc84-4dfa-92f8-7525f6f81708.png)


## Create VM

Run the following command to get a list of subgroups and commands at the root level of the CLI

```bash
az --help
```


Run the following command to get a list of subgroups and commands for Azure Virtual Machines:

```bash
az vm --help
```

![image](https://user-images.githubusercontent.com/34960418/168262366-c2fcc674-d040-43e4-bda5-505a35e02bcf.png)


Run the following command to get a list of arguments and examples for the **Create Virtual Machine** command:

```bash
az vm create --help
```

![image](https://user-images.githubusercontent.com/34960418/168263859-94a83a2d-936e-464c-b404-44d46de6f8f9.png)


Run the following command to create a new **virtual machine** with the following settings, be sure to record the password you are asked to create below you will need it later in the lab to access your virtual machine:

-	Resource group: **ContainerCompute**
-	Name: **quickvm**
-	Image: **Debian**
-	Admin-Username: **student**
-	Admin-Password: **\<CreateYourPassword\>**

> Note: Replace **`<CreateYourPassword>`** in the command below with your own password.

```bash
az vm create --resource-group ContainerCompute --name quickvm --image Debian --admin-username student --admin-password <CreateYourPassword>
```

> **Note**: Wait for the VM to be created. After the process completes, the command will return a  JavaScript Object Notation (JSON) file containing details about the machine.

![image](https://user-images.githubusercontent.com/34960418/168264490-47a299cf-bf3b-47b6-af55-862c73719e2e.png)

![image](https://user-images.githubusercontent.com/34960418/168264656-98f17c39-d29f-4c25-90e1-cb334f51ef5b.png)


Run the following command to get a more detailed JSON file that contains various metadata about the newly created VM:

```bash
az vm show --resource-group ContainerCompute --name quickvm
```

![image](https://user-images.githubusercontent.com/34960418/168264824-fd2ced11-d672-4d36-8326-11e2abf4b41c.png)


Run the following command to list all the IP addresses associated with the VM:

```bash
az vm list-ip-addresses --resource-group ContainerCompute --name quickvm
```

![image](https://user-images.githubusercontent.com/34960418/168265165-a886644b-dd84-4944-8f8a-d5a85c474f2d.png)


Run the following command to filter the output to only return the first IP address value:

```bash
az vm list-ip-addresses --resource-group ContainerCompute --name quickvm --query '[].{ip:virtualMachine.network.publicIpAddresses[0].ipAddress}' --output tsv
```

![image](https://user-images.githubusercontent.com/34960418/168265493-46c130a7-ab25-4c2e-afbe-223787ddff93.png)


Run the following command to store the results of the previous command in a new Bash shell variable named *ipAddress*:

```bash
$IP_ADDRESS=$(az vm list-ip-addresses --resource-group ContainerCompute --name quickvm --query '[].{ip:virtualMachine.network.publicIpAddresses[0].ipAddress}' --output tsv)
```

Run the following command to render the value of the Bash shell variable *ipAddress*:

```bash
echo $IP_ADDRESS
```

![image](https://user-images.githubusercontent.com/34960418/168266981-9df6e1e4-d8a9-42ad-8adb-bf7967b7457c.png)


Run the following command to connect to the VM that you created previously in this lab, by using the Secure Shell (SSH) tool and the IP address stored in the Bash shell variable *ipAddress*:

```bash
ssh student@$IP_ADDRESS
```

The SSH tool informs you that the authenticity of the host canâ€™t be established and then asks if you want to continue connecting. Enter **yes**, and then select Enter to continue connecting to the VM. The SSH tool then asks for a password. Enter the password you created earlier, and then select Enter to authenticate with the VM.

![image](https://user-images.githubusercontent.com/34960418/168267191-538b9ef9-b3bc-4185-be70-0595fc7ab9ee.png)


After connecting to the VM by using SSH, run the following command to get metadata describing the Linux VM:

```bash
uname -a
```

![image](https://user-images.githubusercontent.com/34960418/168267637-38ae1ac1-8f42-488c-b6b5-44537a5900ba.png)


Use the **exit** command to end your SSH session:

```bash
exit
```


## Review

In this exercise, you used Cloud Shell to create a VM as part of an automated script.
